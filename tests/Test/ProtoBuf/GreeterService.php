<?php

declare(strict_types=1);

# Generated by the protocol buffer compiler (for Phluxor). DO NOT EDIT!
# source: protobuf/helloworld.proto

namespace Test\ProtoBuf;

use Phluxor\WebSocket;

class GreeterService implements GreeterInterface
{
    /**
     * @param WebSocket\ContextInterface $ctx
     * @param HelloRequest $request
     * @return HelloReply
     *
     * @throws WebSocket\Exception\InvokeException
     */
    public function SayHello(WebSocket\ContextInterface $ctx, HelloRequest $request): HelloReply // @phpcs:ignore
    {
        $name = $request->getName();
        $out = new HelloReply();
        $out->setMessage('world ' . $name . time());
        $message = new WebSocket\Message($ctx, $out);
        $ctx[WebSocket\Constant::SERVER_WORKER_CONTEXT]->getValue(WebSocket\Server::class)->push($message);
        \Swoole\Coroutine::sleep(0.01);
        return $out;
    }
}
